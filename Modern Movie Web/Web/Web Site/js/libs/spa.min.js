(function(n,t){"use strict";var u=".",i=".spa-layout",f=t,r=function(t){var i=new r.fn.init,u="",f;if(i.settings=$.extend({},i.settings,t),i.settings.AppContext)i.$context=i.settings.AppContext;else if(f=document.querySelector("[spa-app]"),f)u=n[f.getAttribute("spa-app")],typeof u=="function"&&(u=u()),i.$context=u;else{console.error("Must have an application context defined");throw{name:"SPA Error",message:"Must have an application context defined"};}return n.addEventListener("DOMContentLoaded",function(){if(i.viewEngine=i.settings.viewEngine||Backpack(),i.analytics=i.settings.analytics,i.titleElement=document.querySelector(i.settings.titleSelector),i.settings.parseDOM&&i.setupRoutes(i.settings.viewSelector),n.addEventListener("hashchange",function(){i.swapView()}),i.getParameterByName(i.settings.forceReload))return n.location.replace(n.location.href.split("?")[0]+"#!"+i.getParameterByName(i.settings.forceReload)),i;i.settings.initView&&i.swapView()}),i};return r.fn=r.prototype={constructor:r,init:function(){return this},version:"0.1.2",viewEngine:t,$context:t,$controller:t,$oldController:t,oldRoute:t,setupRoutes:function(){for(var t=this,r=t.settings,u=$.extend($.parseLocalStorage("routes")||{},r.routes),f=0,e,n,i,o,s=document.querySelectorAll(r.viewSelector);f<s.length;f++)n=s[f],n.hasAttributes()&&n.hasAttribute("id")&&(o=n.getAttribute("id"),e=n.hasAttribute("spa-route")?n.getAttribute("spa-route"):"",i=t.createRoute(o,e,n),i&&(u[i.path]=i));t.settings.routes=u;localStorage.setItem("routes",JSON.stringify(u));t.viewEngine&&t.getParameterByName("_escaped_fragment_")===""&&t.viewEngine.parseViews(r.viewSelector)},createRoute:function(n,i,r){var u={viewId:n,viewModule:r.hasAttribute("spa-module")?r.getAttribute("spa-viewId"):n,path:i.split("/:")[0],params:i.split("/:").slice(1),title:r.hasAttribute("spa-title")?r.getAttribute("spa-title"):this.settings.defaultTitle,viewType:r.hasAttribute("spa-view-type")?r.getAttribute("spa-view-type"):"view",layout:r.hasAttribute("spa-layout")?r.getAttribute("spa-layout"):t,transition:r.hasAttribute("spa-transition")?r.getAttribute("spa-transition"):"",paramValues:{},beforeonload:r.hasAttribute("spa-beforeonload")?r.getAttribute("spa-beforeonload"):t,onload:r.hasAttribute("spa-onload")?r.getAttribute("spa-onload"):t,afteronload:r.hasAttribute("spa-afteronload")?r.getAttribute("spa-afteronload"):t,beforeunload:r.hasAttribute("spa-beforeunload")?r.getAttribute("spa-beforeunload"):t,unload:r.hasAttribute("spa-unload")?r.getAttribute("spa-unload"):t,afterunload:r.hasAttribute("spa-afterunload")?r.getAttribute("spa-afterunload"):t};if(u.viewType==="view")return u},matchRouteByPath:function(n,i){i||(i=this.settings.routes);var f,r,e,u,o={},s;if(i.hasOwnProperty(n))return i[n];for(f in i)if(i.hasOwnProperty(f))if(r=i[f],s=new RegExp("\\b"+r.path+"\\b","gi"),r.path!==""&&n.search(s)===0){for(e=n.replace(r.path,"").split("/").slice(1),u=0;u<e.length;u++)o[r.params[u]]=e[u];r.paramValues=o;break}else r=t;return r},matchRouteById:function(n,t){t||(t=this.settings.routes);for(var i in t)if(t[i].viewId===n)return t[i]},animation:t,getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))},getVendorPropertyName:function(n){var r=["Moz","Webkit","O","ms"],i,t,u=n.charAt(0).toUpperCase()+n.substr(1);if(n in this.div.style)return n;for(t=0;t<r.length;++t)if(i=r[t]+u,i in this.div.style)return i},transitionend:{animation:"animationend",webkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oAnimationEnd"},cssPrefix:function(n){if(!n)return"";var t,r,i,u,f=document.body.style;if(n.indexOf("-")>=0){for(i=(""+n).split("-"),t=1,r=i.length;t<r;t++)i[t]=i[t].substr(0,1).toUpperCase()+i[t].substr(1);n=i.join("")}if(n in f)return n;for(n=n.substr(0,1).toUpperCase()+n.substr(1),u=["webkit","Moz","ms","O"],t=0,r=u.length;t<r;t++)if(u[t]+n in f)return u[t]+n;return""},removeExtraViews:function(n){if(n)for(var t=n.length;t>1;)t--,n[t].parentNode.removeChild(n[t]);return n[0]},pushView:function(n){var t=this;t.analytics&&t.analytics.pushView(["_trackPageview",n])},getHashPath:function(){var t=n.location.hash!=="#"?n.location.hash.replace("#!",""):"";return t=t.split(":")[0],t.replace(new RegExp("\\\\$"),"")},getClassSelector:function(n){return u+n},getOldRoute:function(n){return n?this.matchRouteById(n):t},getController:function(n){var i=this,t=i.$context[n.viewId];return t&&typeof t=="function"?new t(i.$context,n):t&&typeof t=="object"?(t=new t,t.response=n,t):void 0},getExistingView:function(){var n=this;return view=document.querySelector("."+n.settings.currentLayoutClass),view||(view=document.querySelector("."+n.settings.currentViewClass)),view},swapView:function(){var r=this,s=r.settings,c,v=t,h,l,o,f,y=r.getParameterByName("_escaped_fragment_"),a=r.getHashPath(),e=r.matchRouteByPath(a);if(!e||y!==""){n.location.hash="#!"+s.NotFoundRoute;return}(o=document.querySelectorAll(u+s.layoutClass),f=document.querySelectorAll(u+s.currentViewClass),o&&o.length>0&&(o=r.removeExtraViews(o)),f&&f.length>0&&(f=r.removeExtraViews(f),v=f?f.id:t),f.length===0&&(f=t),r.oldRoute!==a)&&(o&&(o.length!==t&&(o=o.length===0?t:o[0]),o&&(f=o)),r.$oldController=r.$controller,r.$controller=r.getController(e),r.$controller)&&(r.pushView(a),f=r.ensureViewAvailable(f,e),h=document.getElementById(e.viewId),h&&(f?(r.makeViewCallback(r.$oldController,"beforeunload"),r.hasAnimations()&&(c=r.getAnimation(e),r.animation=c,c?(f.addEventListener(r.transitionend[r.cssPrefix("animation")],function(){r.endSwapAnimation(r.oldRoute,e,f);l=t}),$(f).addClass("animated out "+c).removeClass("in"),$(h).addClass(s.currentViewClass+" animated "+c+" in"),$(i).addClass("show")):($(h).addClass(s.currentViewClass),$(i).addClass("show"),r.endSwapAnimation(r.oldRoute,e,f)))):s.intoAnimation?(h.addEventListener(r.transitionend[r.cssPrefix("animation")],function(){r.endSwapAnimation.call(r,r.oldRoute,e,l);l=t}),$(h).addClass(s.currentViewClass+" animated "+c+" in"),$(i).addClass("show")):($(h).addClass(s.currentViewClass),r.endSwapAnimation.call(r,r.oldRoute,e,l),$(i).addClass("show")),r.setDocumentTitle(e),e&&r.$controller&&(r.makeViewCallback(r.$controller,"beforeonload",e),r.makeViewCallback(r.$controller,"onload",e),r.makeViewCallback(r.$controller,"afteronload",e))),r.oldRoute=a)},getAnimation:function(n){return n?this.animations[n.transition]||this.settings.viewTransition:this.settings.viewTransition},endSwapAnimation:function(n,t,i){var r=this,u=document.getElementById(t.viewId),f,e=r.animation;n&&(r.makeViewCallback(r.$oldController,"unload"),r.makeViewCallback(r.$oldController,"afterunload"));u&&u.classList.contains("in")&&(u.classList.remove("in"),u.classList.remove(e));i&&r.viewEngine&&i.parentNode&&(f=i.parentNode,f.removeChild(i))},ensureViewAvailable:function(t,r){var f=this,o,u,e,s;return f.viewEngine&&(o=f.viewEngine.getView(r),o?e=f.createFragment(o):(s=n.location.href.split("#!"),n.location.replace(s[0]+"?"+f.settings.forceReload+"="+s[1])),t?r.layout?document.querySelector(i)?(u=document.querySelector(i),u&&u.parentNode.insertBefore(e,u)):t.parentNode.insertBefore(e,t):(u=document.querySelector(i),u&&(t=u),t.parentNode.insertBefore(e,t)):document.querySelector(f.settings.mainWrappperSelector).appendChild(e)),t},makeViewCallback:function(n,t,i){n&&n[t]&&n[t].call(n,i||{})},setDocumentTitle:function(n){var i=n.title,t;if(i!==""){for(t=0;t<n.params.length;t++)i=i.replace(":"+n.params[t],n.paramValues[n.params[t]]);document.title=i}},createFragment:function(n){var i=document.createDocumentFragment(),t=document.createElement("div");for(t.innerHTML=n;t.firstChild;)i.appendChild(t.firstChild);return i},hasAnimations:function(){var i=!1,f=document.createElement("div"),e="animation",o="",r="Webkit Moz O ms Khtml".split(" "),u="",n=0;if(f.style.animationName&&(i=!0),i===!1)for(n=0;n<r.length;n++)if(f.style[r[n]+"AnimationName"]!==t){u=r[n];e=u+"Animation";o="-"+u.toLowerCase()+"-";i=!0;break}return i},animations:{slide:"slide",fade:"fade",flip:"flip"},settings:{routes:[],viewSelector:"[type='text/x-Rivets-template']",currentViewClass:"spa-current-view",currentLayoutClass:"spa-current-layout",layoutClass:"spa-layout",viewClass:"spa-view",mainWrappperSelector:"main",NotFoundView:"nofoundView",NotFoundRoute:"404",defaultTitle:"A Single Page Application with Routes",titleSelector:".view-title",forceReload:"_force_reload_",autoSetTitle:!0,parseDOM:!0,initView:!0,transitionFullLayout:!0,intoAnimation:!0,viewTransition:"slide",asyncUrl:t}},r.fn.init.prototype=r.fn,n.SPA=r})(window);
//# sourceMappingURL=spa.min.js.map

/*
//# sourceMappingURL=spa.min.js.map
*/