(function(n,t){"use strict";var u=".",r=".spa-layout",f=t,i=function(t){var r=new i.fn.init,u="",f;if(r.settings=$.extend({},r.settings,t),r.settings.AppContext)r.$context=r.settings.AppContext;else if(f=document.querySelector("[spa-app]"),f)u=n[f.getAttribute("spa-app")],typeof u=="function"&&(u=u()),r.$context=u;else{console.error("Must have an application context defined");throw new ReferenceError("Must have an application context defined");}return n.addEventListener("DOMContentLoaded",function(){if(r.viewEngine=r.settings.viewEngine,r.pm=r.settings.pm,r.analytics=r.settings.analytics,r.titleElement=document.querySelector(r.settings.titleSelector),r.settings.parseDOM&&(r.pm.setupRoutes(document.querySelectorAll(".spa-view")),r.viewEngine.parseViews()),n.addEventListener("hashchange",function(){r.swapView()}),r.getParameterByName(r.settings.forceReload))return n.location.replace(n.location.href.split("?")[0]+"#!"+r.getParameterByName(r.settings.forceReload)),r;r.settings.initView&&r.swapView()}),r};return i.fn=i.prototype={constructor:i,init:function(){return this},version:"0.1.2",viewEngine:t,$context:t,$controller:t,$oldController:t,oldRoute:t,matchRouteByPath:function(n,i){i||(i=this.pm.getRoutes());var f,r,e,u,o={},s;if(i.hasOwnProperty(n))return i[n];for(f in i)if(i.hasOwnProperty(f))if(r=i[f],s=new RegExp("\\b"+r.path+"\\b","gi"),r.path!==""&&n.search(s)===0){for(e=n.replace(r.path,"").split("/").slice(1),u=0;u<e.length;u++)o[r.params[u]]=e[u];r.paramValues=o;break}else r=t;return r},matchRouteById:function(n,t){t||(t=this.pm.getRoutes());for(var i in t)if(t[i].viewId===n)return t[i]},animation:t,getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))},getVendorPropertyName:function(n){var r=["Moz","Webkit","O","ms"],i,t,u=n.charAt(0).toUpperCase()+n.substr(1);if(n in this.div.style)return n;for(t=0;t<r.length;++t)if(i=r[t]+u,i in this.div.style)return i},transitionend:{animation:"animationend",webkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oAnimationEnd"},cssPrefix:function(n){if(!n)return"";var t,r,i,u,f=document.body.style;if(n.indexOf("-")>=0){for(i=(""+n).split("-"),t=1,r=i.length;t<r;t++)i[t]=i[t].substr(0,1).toUpperCase()+i[t].substr(1);n=i.join("")}if(n in f)return n;for(n=n.substr(0,1).toUpperCase()+n.substr(1),u=["webkit","Moz","ms","O"],t=0,r=u.length;t<r;t++)if(u[t]+n in f)return u[t]+n;return""},removeExtraViews:function(n){if(n)for(var t=n.length;t>1;)t--,n[t].parentNode.removeChild(n[t]);return n[0]},pushView:function(n){var t=this;t.analytics&&t.analytics.pushView(["_trackPageview",n])},getHashPath:function(){var t=n.location.hash!=="#"?n.location.hash.replace("#!",""):"";return t=t.split(":")[0],t.replace(new RegExp("\\\\$"),"")},getClassSelector:function(n){return u+n},getOldRoute:function(n){return n?this.matchRouteById(n):t},getController:function(n){var i=this,t=i.$context[n.viewId];return t&&typeof t=="function"?new t(i.$context,n):t&&typeof t=="object"?(t=new t,t.response=n,t):void 0},getExistingView:function(){var n=this;return view=document.querySelector("."+n.settings.currentLayoutClass),view||(view=document.querySelector("."+n.settings.currentViewClass)),view},swapView:function(){var i=this,s=i.settings,c,v=t,h,l,o,f,y=i.getParameterByName("_escaped_fragment_"),a=i.getHashPath(),e=i.matchRouteByPath(a);if(!e||y!==""){n.location.hash="#!"+s.NotFoundRoute;return}(o=document.querySelectorAll(u+s.layoutClass),f=document.querySelectorAll(u+s.currentViewClass),o&&o.length>0&&(o=i.removeExtraViews(o)),f&&f.length>0&&(f=i.removeExtraViews(f),v=f?f.id:t),f.length===0&&(f=t),i.oldRoute!==a)&&(o&&(o.length!==t&&(o=o.length===0?t:o[0]),o&&o.getAttribute("spa-layout")!==e.layout&&(f=o)),i.$oldController=i.$controller,i.$controller=i.getController(e),i.$controller)&&(i.pushView(a),h=i.stampView(f,e),c=i.getAnimation(e),i.animation=c,h&&(f?(i.makeViewCallback(i.$oldController,"beforeunload"),i.hasAnimations()&&(c?(f.addEventListener(i.transitionend[i.cssPrefix("animation")],function(){i.endSwapAnimation(i.oldRoute,e,f);l=t}),$(f).addClass("animated out "+c).removeClass("in"),$(h).addClass(s.currentViewClass+" show animated "+c+" in"),$(r).addClass("show")):($(h).addClass(s.currentViewClass),$(r).addClass("show"),i.endSwapAnimation(i.oldRoute,e,f)))):s.intoAnimation?(h.addEventListener(i.transitionend[i.cssPrefix("animation")],function(){i.endSwapAnimation.call(i,i.oldRoute,e,l);l=t}),$(h).addClass(s.currentViewClass+" show animated "+c+" in"),$(r).addClass("show")):($(h).addClass(s.currentViewClass+" show"),i.endSwapAnimation.call(i,i.oldRoute,e,l),$(r).addClass("show")),i.setDocumentTitle(e),e&&i.$controller&&(i.makeViewCallback(i.$controller,"beforeonload",e),i.makeViewCallback(i.$controller,"onload",e),i.makeViewCallback(i.$controller,"afteronload",e))),i.oldRoute=a)},getAnimation:function(n){return n?this.animations[n.transition]||this.settings.viewTransition:this.settings.viewTransition},endSwapAnimation:function(n,t,i){var r=this,u=document.getElementById(t.viewId),f,e=r.animation;n&&(r.makeViewCallback(r.$oldController,"unload"),r.makeViewCallback(r.$oldController,"afterunload"));u&&u.classList.contains("in")&&(u.classList.remove("in"),u.classList.remove(e));i&&r.viewEngine&&i.parentNode&&(f=i.parentNode,f.removeChild(i))},stampView:function(t,i){var u=this,o,f,e,r;return u.viewEngine&&(o=u.viewEngine.getView(i.viewId),o?e=u.createFragment(o):(r=n.location.href.split("#!"),n.location.replace(r[0]+"?"+u.settings.forceReload+"="+r[1])),i.layout?(f=document.querySelector("[spa-layout='"+i.layout+"']"),f?(r=f.querySelector(u.settings.layOutPlaceholder),t&&!t.classList.contains("spa-layout")?r.insertBefore(e,t):r.appendChild(e)):(f=u.viewEngine.getView(i.layout),f&&(f=u.createFragment(f),r=document.querySelector(u.settings.mainWrappperSelector),r.appendChild(f),f=document.querySelector("[spa-layout='"+i.layout+"']")),r=f.querySelector(u.settings.layOutPlaceholder),r.appendChild(e))):(r=document.querySelector(u.settings.mainWrappperSelector),t?r.insertBefore(e,t):r.appendChild(e))),document.querySelector(i.spaViewId)},makeViewCallback:function(n,t,i){n&&n[t]&&n[t].call(n,i||{})},setDocumentTitle:function(n){var i=n.title,t;if(i!==""){for(t=0;t<n.params.length;t++)i=i.replace(":"+n.params[t],n.paramValues[n.params[t]]);document.title=i}},createFragment:function(n){var i=document.createDocumentFragment(),t=document.createElement("div");for(t.innerHTML=n;t.firstChild;)i.appendChild(t.firstChild);return i},hasAnimations:function(){var i=!1,f=document.createElement("div"),e="animation",o="",r="Webkit Moz O ms Khtml".split(" "),u="",n=0;if(f.style.animationName&&(i=!0),i===!1)for(n=0;n<r.length;n++)if(f.style[r[n]+"AnimationName"]!==t){u=r[n];e=u+"Animation";o="-"+u.toLowerCase()+"-";i=!0;break}return i},animations:{slide:"slide",fade:"fade",flip:"flip"},settings:{routes:[],viewSelector:".spa-view",currentViewClass:"spa-current-view",currentLayoutClass:"spa-current-layout",layoutClass:"spa-layout",layOutPlaceholder:".spa-child-view",viewClass:"spa-view",mainWrappperSelector:".main-content",NotFoundView:"nofoundView",NotFoundRoute:"404",defaultTitle:"A Single Page Application with Routes",titleSelector:".view-title",forceReload:"_force_reload_",autoSetTitle:!0,parseDOM:!0,initView:!0,transitionFullLayout:!0,intoAnimation:!0,viewTransition:"slide",asyncUrl:t}},i.fn.init.prototype=i.fn,n.SPA=i})(window);